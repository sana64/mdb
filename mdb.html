<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Множество Мандельброта с Bootstrap</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        canvas {
            display: block;
            margin: 0 auto;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .controls {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .color-preset {
            width: 30px;
            height: 30px;
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .info-block {
            background-color: #f8f9fa;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">Визуализация множества Мандельброта</h1>
        
        <div class="row">
            <div class="col-md-8">
                <canvas id="mandelbrotCanvas" width="600" height="600"></canvas>
            </div>
            
            <div class="col-md-4">
                <div class="controls mb-4">
                    <h4>Управление</h4>
                    
                    <div class="mb-3">
                        <label class="form-label">Максимум итераций: <span id="iterationsValue">100</span></label>
                        <input type="range" class="form-range" id="iterations" min="10" max="500" value="100">
                    </div>
                    
                    <div class="mb-3">
                        <button class="btn btn-primary w-100" id="resetView">Сбросить вид</button>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Цветовая схема:</label>
                        <div>
                            <div class="color-preset" style="background: linear-gradient(to right, #000, #00f, #0ff, #fff);" data-preset="default"></div>
                            <div class="color-preset" style="background: linear-gradient(to right, #000, #f00, #ff0, #fff);" data-preset="fire"></div>
                            <div class="color-preset" style="background: linear-gradient(to right, #000, #0f0, #ff0, #fff);" data-preset="forest"></div>
                            <div class="color-preset" style="background: linear-gradient(to right, #000, #f0f, #0ff, #fff);" data-preset="purple"></div>
                        </div>
                    </div>
                </div>
                
                <div class="info-block">
                    <h4>О множестве Мандельброта</h4>
                    <p>Множество Мандельброта — это фрактал, определённый как множество точек c на комплексной плоскости.</p>
                    <p>Кликните на любую область для увеличения. Используйте ползунок для изменения детализации.</p>
                    <p class="mb-0" id="coordinates">Координаты: Не вычислено</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & Popper -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('mandelbrotCanvas');
            const ctx = canvas.getContext('2d');
            const iterationsInput = document.getElementById('iterations');
            const iterationsValue = document.getElementById('iterationsValue');
            const resetViewBtn = document.getElementById('resetView');
            const coordinatesInfo = document.getElementById('coordinates');
            
            // Начальные параметры отображения
            let maxIterations = parseInt(iterationsInput.value);
            let colorPreset = 'default';
            
            // Параметры отображения
            let xMin = -2.5, xMax = 1.5;
            let yMin = -2, yMax = 2;
            
            // Обработчики событий
            iterationsInput.addEventListener('input', function() {
                maxIterations = parseInt(this.value);
                iterationsValue.textContent = maxIterations;
                drawMandelbrot();
            });
            
            resetViewBtn.addEventListener('click', function() {
                xMin = -2.5; xMax = 1.5;
                yMin = -2; yMax = 2;
                drawMandelbrot();
            });
            
            // Обработчики для цветовых пресетов
            document.querySelectorAll('.color-preset').forEach(preset => {
                preset.addEventListener('click', function() {
                    colorPreset = this.getAttribute('data-preset');
                    drawMandelbrot();
                });
            });
            
            // Обработчик клика для увеличения
            canvas.addEventListener('click', function(event) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                // Преобразование координат канваса в координаты Мандельброта
                const clickX = xMin + (x / canvas.width) * (xMax - xMin);
                const clickY = yMin + (y / canvas.height) * (yMax - yMin);
                
                // Новые границы (увеличиваем в 2.5 раза)
                const zoomFactor = 0.4;
                const newWidth = (xMax - xMin) * zoomFactor;
                const newHeight = (yMax - yMin) * zoomFactor;
                
                xMin = clickX - newWidth / 2;
                xMax = clickX + newWidth / 2;
                yMin = clickY - newHeight / 2;
                yMax = clickY + newHeight / 2;
                
                drawMandelbrot();
            });
            
            // Функция для вычисления принадлежности точки к множеству Мандельброта
            function mandelbrot(cRe, cIm, maxIter) {
                let zRe = 0, zIm = 0;
                
                for (let i = 0; i < maxIter; i++) {
                    const zRe2 = zRe * zRe;
                    const zIm2 = zIm * zIm;
                    
                    if (zRe2 + zIm2 > 4) {
                        return i; // Точка не принадлежит множеству
                    }
                    
                    zIm = 2 * zRe * zIm + cIm;
                    zRe = zRe2 - zIm2 + cRe;
                }
                
                return maxIter; // Точка принадлежит множеству
            }
            
            // Функция выбора цвета на основе количества итераций
            function getColor(iterations) {
                if (iterations === maxIterations) {
                    return '#000'; // Черный для точек внутри множества
                }
                
                const t = iterations / maxIterations;
                
                switch(colorPreset) {
                    case 'fire':
                        const r = Math.min(255, Math.floor(255 * t * 2));
                        const g = Math.min(255, Math.floor(255 * t));
                        const b = Math.min(255, Math.floor(255 * t * 0.5));
                        return `rgb(${r}, ${g}, ${b})`;
                    
                    case 'forest':
                        return `hsl(${120 * t}, 100%, ${50 * t}%)`;
                    
                    case 'purple':
                        return `hsl(${280 + 80 * t}, 100%, ${50 * t}%)`;
                    
                    default: // default
                        return `hsl(${360 * t}, 100%, ${50 * t}%)`;
                }
            }
            
            // Основная функция отрисовки
            function drawMandelbrot() {
                const imageData = ctx.createImageData(canvas.width, canvas.height);
                const data = imageData.data;
                
                for (let x = 0; x < canvas.width; x++) {
                    for (let y = 0; y < canvas.height; y++) {
                        // Преобразование координат пикселя в координаты комплексной плоскости
                        const cRe = xMin + (x / canvas.width) * (xMax - xMin);
                        const cIm = yMin + (y / canvas.height) * (yMax - yMin);
                        
                        const iterations = mandelbrot(cRe, cIm, maxIterations);
                        const color = getColor(iterations);
                        
                        // Преобразование цвета в RGB
                        const rgb = color.match(/\d+/g);
                        const idx = (y * canvas.width + x) * 4;
                        
                        data[idx] = parseInt(rgb[0]);     // R
                        data[idx + 1] = parseInt(rgb[1] || rgb[0]); // G
                        data[idx + 2] = parseInt(rgb[2] || rgb[0]); // B
                        data[idx + 3] = 255; // Alpha
                    }
                }
                
                ctx.putImageData(imageData, 0, 0);
                
                // Обновление информации о координатах
                coordinatesInfo.textContent = `Координаты: [${xMin.toFixed(4)}, ${yMin.toFixed(4)}] - [${xMax.toFixed(4)}, ${yMax.toFixed(4)}]`;
            }
            
            // Инициализация
            drawMandelbrot();
        });
    </script>
</body>
</html>
